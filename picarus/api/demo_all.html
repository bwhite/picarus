<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>api.picar.us: API Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.1.1/css/bootstrap-combined.min.css" rel="stylesheet">
    <link href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.1.1/bootstrap.min.js" rel="stylesheet">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script type="text/javascript" src="//stringencoders.googlecode.com/svn-history/r210/trunk/javascript/base64.js"></script>
    <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.1.1/js/bootstrap.min.js"></script>
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="../assets/ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="#">api.picar.us</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <!--<li class="active"><a href="#">Home</a></li>
              <li><a href="#about">About</a></li>
              <li><a href="#contact">Contact</a></li>-->
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container">
      <div class="content">
        <div class="page-header">
          <h1>API Demo</h1>
        </div>
        <div class="row">
          <div class="span16">
	    <div class="row">
	      <div class="span4">
		<div class="progress progress-striped active">
		  <div class="bar bar-success" style="width: 0%;" id="pbar-success"></div>
		  <div class="bar bar-danger" style="width: 0%;" id="pbar-danger"></div>
		</div>
		<div>
		  <img id="texton_argmax"></img>
		</div>
	      </div>
	      <div class="span8">
		<div class="hero-unit" style="padding-top: 10px; padding-bottom: 10px; padding-left: 10px; padding-right: 10px;">
		  <input type="file" id="demoimage" class="input-small">
		  <input class="input-small" type="text" placeholder="Username" id="demouser" value="user">
		  <input class="input-small" type="password" placeholder="Password" id="demopass" value="pass">
		  <button class="btn" type="submit" id="demobutton" style="margin-bottom: 9px">Run Demo</button>
		</div>
		<div id="base" style="position:relative;top:-35px;"></div>
		<h2>PUT /see/feature/GIST</h2>
		<div id="results_gist" class="result_box"></div>
		<h2>PUT /see/search/logos</h2>
		<div id="results_logos" class="result_box"></div>
		<h2>PUT /see/search/scenes</h2>
		<div id="results_scenes" class="result_box"></div>
		<h2>PUT /see/texton</h2>
		<div id="results_texton" class="result_box"></div>
		<h2>PUT /see/faces</h2>
		<div id="results_faces" class="result_box"></div>
              </div>
	      </div>
	    </div>
        </div>
      </div>

    </div> <!-- /container -->
    <script type="text/javascript">
      function picarus_api_test(url, method, data, user, pass, result_selector, result_success) {
          function clear_error() {
              $('#demobutton').removeClass('danger info success');
          }
          function report_result(xhr, label_type) {
              debug_output = xhr.responseText;
              result_selector.html('<span class="label ' + label_type +'">' + xhr.status + '</span><p><pre>' + data  +  '</pre></p><p><pre>' + xhr.getAllResponseHeaders() + '</pre></p><p><pre>' + xhr.responseText + '</pre></p>');
          }
          function before_send(xhr) {
              clear_error();
              $('#demobutton').addClass('success');
              result_selector.html('<span class="label warning">' + 'Running' + '</span>');
          }
          function success(msg, text_status, xhr) {
              report_result(xhr, "label-success");
              progress_success += 1;
              update_bar();
              if (typeof result_success != 'undefined') {
                  result_success(xhr);
              }
          }
          function fail(xhr, text_status) {
              clear_error();
              $('#demobutton').addClass('danger');
              report_result(xhr, "label-important");
              progress_fail += 1;
              update_bar();
          }
          picarus_api(url, method, data, user, pass, before_send, success, fail);
      }
      function picarus_api(url, method, data_dict, user, pass, before_send, success, fail) {
          if (typeof before_send == 'undefined' ) before_send = function() {};
          if (typeof success == 'undefined' ) success = function() {};
          if (typeof fail == 'undefined' ) fail = function() {};
          var data = new FormData();
          jQuery.each($('#demoimage')[0].files, function(i, file) {
              data.append('image', file);
          });
          jQuery.each(data_dict, function(k, v) {
              data.append(k, v);
          });
          var request = $.ajax({
          type: method,
          url: url,
          contentType: false,
          processData: false,
          cache: false,
          beforeSend: function(xhr) {
              xhr.setRequestHeader("Authorization", "Basic " + base64.encode(user + ":" + pass));
              before_send(xhr);
          },
          data: data,
          success: success
          });
          request.fail(fail);
      }
      function update_box() {
          reset_bar();
          update_bar();
          picarus_api_test("/see/feature/GIST", "POST", {}, $('#demouser').val(), $('#demopass').val(), $("#results_gist"));
          picarus_api_test("/see/search/logos", "POST", {}, $('#demouser').val(), $('#demopass').val(), $("#results_logos"));
          picarus_api_test("/see/search/scenes", "POST", {}, $('#demouser').val(), $('#demopass').val(), $("#results_scenes"));
          function success_texton_argmax(xhr) {
              $('#texton_argmax').attr('src', 'data:image/png;base64,' + JSON.parse(xhr.responseText)['argmax_pngb64']);
          }
          picarus_api_test("/see/texton", "POST", {}, $('#demouser').val(), $('#demopass').val(), $("#results_texton"), success_texton_argmax);
          picarus_api_test("/see/faces", "POST", {}, $('#demouser').val(), $('#demopass').val(), $("#results_faces"));
      }
      function reset_bar() {
          progress_total = $('.result_box').length;
          progress_success = 0;
          progress_fail = 0;
      }
      function update_bar() {
          $('#pbar-success').css('width', String(100 * progress_success / progress_total) + "%");
          $('#pbar-danger').css('width', String(100 * progress_fail / progress_total) + "%");
      }
      function entry_func() {
          $('#demobutton').click(update_box);
          var submit_func = function(event) {
              if(event.keyCode == 13) {
                  $("#demobutton").click();
              }
          }
          $("#demourl").keyup(submit_func);
          $("#demouser").keyup(submit_func);
          $("#demopass").keyup(submit_func);
          reset_bar();
          update_bar();
      }
      $(document).ready(entry_func)
    </script>
  </body>
</html>
